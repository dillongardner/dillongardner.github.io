---
title: "STL_Part_II"
author: "Dillon Gardner"
date: "November 22, 2016"
output: html_document
---

STL (Seasonal Trend decomposition using Loess) was developed by Cleveland et al. [(Journal of Official Statistics 6 No. 1 pp 3-33 1990)] (http://www.wessa.net/download/stl.pdf) The core idea is that a time series can be decomposed into three components: seasonal, trend and remainder ($Y_\nu = T_\nu + S_\nu + R_\nu$). The The notional of seasonal variation is always intrinsically ambiguous: whether the temporal variation should be considered Seasonal, Trend, or Remainder is, to a degree, a matter of opinion and determined by choice of model and model parameters. This is true in STL as well as any seasonal variational approach.

Key to the STL approach is Loess smoothing. This provides smooth estimate $g(x)$ for $y$ at all values of $x$, not just at values for which $x$ has been measured. To calculate $g$, a positive integer $q$ is chosen. A larger $q$, yields greater smoothing. The $q$ values of $x_i$ that are closes to $x$ are selected and each is weighted by how far it is from $x$. The weight is determined as $v_i = W(|x_i−x|$) where $W$ is the tricube weight function and $\lambda_q (x)$
is the distance from the qth farthest point (for $q < N$. If $q >= N$, additional scale terms must be used). A polynomial of degree $d$ is fit to the selected $(x_i,y_i)$ with weights $v_i$. If robustness weights exist, use weights $\rho_i v_i$. Typically $d$ is one or two. For STL, selection of smoothing parameters $q$ is a key model choice.

Model parameters

* $n_{(p)}$ = number of observations in each cycle of the seasonal component
* $n_{(i)}$ = number of cycles through the inner loop. Number of cycles should be large enough to reach convergence. When multiple outer cycles, the number of inner cycles can be smaller as they do not necessarily help get overall convergence
* $n_{(o)}$ = number of cycles through the outer loop. More cycles here reduce the affect of outliers
* $n_{(l)}$ = the span in lags for the low-pass filter. Almost always taken as the least odd integer greater
than or eqaul to $n(p)$
* $n_{(s)}$ = smoothing parameter for the seasonal filter. As ns increases, each cycle subseries becomes
smoother. This is one of the parameters with the most freedom of choice from the modeler. It looks like it can become a question of what the modeler believes is changes in seasonal behavior versus aberrant behavior.
* $n_{(t)}$ = smoothing parameter of the trend behavior. As this increases, the trend is increasingly smoothed. The authors recommend “consider [the trend] to be a component whose estimation is needed to form an estimate of the seasonal.” If more careful trend modeling is needed, they recommend first extracting the seasonal, then model the sum of $T_\nu + R_\nu$.

In addition to these six paramters, the degree of the loess smoothing can be changed. The default is typically $d$ = 1 for all the smoothing. There are more paramters in the R STL function, which are related to the computation parameters and (I believe) do not affect the resulting model.


## Algorithmic sketch

The general idea is an interative update of the trend and seasonal components. This is done by subtracting the current estimate of the trend from the raw series. The time series is then partition into cycle-subseries (e.g. if it is monthly data with a yearly season, then there will be 12 cycle subseries: all Januarys will be one TS, all February a second, etc.). The cycle-subseries are loess smoothed and then passed thorugh a low-pass filter. The seasonal components are the smoothed cycle-subseries minus the result from the low-pass filter. The seasonal components are subtracted from the raw data. The result is loess smoothed, which becomes the
trend. What is left is the remainder.
￼1
1. Initialize trend as Tν(0) = 0
2. Outer loop
• Calculate Rν
• Calculate robustness weights ρν = B(|Rν |/h) where h = 6 ∗ median(|Rν |) and B is the bisquare weight
function
• On initial loop, ρν = 1 3 Inner loop
• Detrend: Yν − Tν
• Cycle-subseries smoothing: results in a temporary seasonal series Ck+1 (depends on n ). In stl package
ν (s)
in R, can use keywork “periodic” instead. The package notes say this makes smoothing “effectively
replace by taking the mean”
• Low-pass filter: The low pass filter on Ck+1 yields Lk+1 (depends on n )
ν ν (l)
• Detrending of smoothed cycle-subseries: Sk+1 = Ck+1 − Lk+1
• Deseasonalizing:Y − Sk+1 νν
• Trend smoothing: Smooth deseasonalized TS. Results in Tk+1 (depends on n ν
ννν
Important for Awesome Guess purposes, STL allows for missing values. Because loess smoothing creates a function g(x) that is defined for all x, the series Cν, Lν, Sν, and Tν are defined even for where values are missing.
